<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Jonathan Jo</title>
    <link href="css/styles.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css"
    />
  </head>
  <body id="page-top">
    <div id="hero-placeholder"></div>
    <div id="nav-placeholder"></div>
    <div id="nav-overlay" class="nav-overlay"></div>
    <div id="about"></div>
    <div id="projects"></div>
    <div id="technologies"></div>
    <div id="portfolio"></div>
    <div id="contact"></div>
    <!-- Bootstrap core JS-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Third party plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script>
      $(function () {
        $(".portfolio-grid").magnificPopup({
          delegate: "a.portfolio-box", // child items
          type: "image",
          gallery: { enabled: true }, // arrows + keyboard nav
          image: {
            titleSrc: function (item) {
              // Use data-title if present; else fall back to the inner caption text
              return (
                item.el.attr("data-title") ||
                item.el.find(".project-name").text() +
                  " â€” " +
                  item.el.find(".project-category").text()
              );
            },
          },
        });
      });
    </script>
    <script>
      function initNavPortal() {
        const item = document.getElementById("nav-contact");
        if (!item) return;

        const trigger = item.querySelector(".nav-trigger");
        let panel = item.querySelector(".nav-panel");
        const overlay = document.getElementById("nav-overlay");

        if (!trigger || !panel || !overlay) return;

        // --- 1) Move panel to <body> (portal)
        const ghost = document.createComment("nav-panel-portal-anchor"); // leave a marker
        item.replaceChild(ghost, panel);
        document.body.appendChild(panel);

        // --- 2) Positioning under the trigger
        function placePanel() {
          const r = trigger.getBoundingClientRect();
          const top = Math.round(r.bottom + 12); // 12px below trigger
          const left = Math.round(r.left + r.width / 2); // centered
          panel.style.top = `${top}px`;
          panel.style.left = `${left}px`;
          panel.style.transform = "translateX(-50%) translateY(8px) scale(.98)";
        }

        // --- 3) Open/close
        function open() {
          placePanel();
          overlay.classList.add("show");
          panel.classList.add("show", "animate-in");
          panel.addEventListener(
            "animationend",
            () => {
              panel.classList.remove("animate-in");
            },
            { once: true }
          );
        }
        function close() {
          overlay.classList.remove("show");
          panel.classList.remove("show");
        }

        // Hover open/close (desktop)
        trigger.addEventListener("mouseenter", open);
        trigger.addEventListener("mouseleave", (e) => {
          // give a tiny grace to reach the panel
          setTimeout(() => {
            if (!panel.matches(":hover") && !trigger.matches(":hover")) close();
          }, 80);
        });
        panel.addEventListener("mouseleave", () => {
          setTimeout(() => {
            if (!panel.matches(":hover") && !trigger.matches(":hover")) close();
          }, 80);
        });
        panel.addEventListener("mouseenter", placePanel); // keep it aligned if fonts shift

        // Click/tap toggle (mobile)
        trigger.addEventListener("click", (e) => {
          e.preventDefault();
          panel.classList.contains("show") ? close() : open();
        });

        // Keep position on scroll/resize while open
        window.addEventListener("resize", () => {
          if (panel.classList.contains("show")) placePanel();
        });
        window.addEventListener("scroll", () => {
          if (panel.classList.contains("show")) placePanel();
        });

        // Esc or overlay click closes
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") close();
        });
        overlay.addEventListener("click", close);
      }
    </script>
    <script>
      function initHeroContactPortal() {
        const trigger = document.querySelector(".hero-contact-trigger");
        const panel = document.querySelector(".hero-contact-panel");
        const overlay = document.getElementById("nav-overlay");
        if (!trigger || !panel || !overlay) return;

        // Portal to <body>
        document.body.appendChild(panel);

        // Harden stacking at runtime (in case other CSS fights it)
        panel.style.position = "fixed";
        panel.style.zIndex = "10002";
        overlay.style.zIndex = "10000";

        function placePanel() {
          const r = trigger.getBoundingClientRect();
          const top = Math.round(r.bottom + 12);
          const left = Math.round(r.left + r.width / 2);
          panel.style.top = `${top}px`;
          panel.style.left = `${left}px`;
          panel.style.transform = "translateX(-50%) translateY(8px) scale(.98)";
        }

        function open() {
          placePanel();
          overlay.classList.add("show");
          panel.classList.add("show", "animate-in");
          panel.addEventListener(
            "animationend",
            () => panel.classList.remove("animate-in"),
            { once: true }
          );
        }
        function close() {
          overlay.classList.remove("show");
          panel.classList.remove("show");
        }

        trigger.addEventListener("mouseenter", open);
        trigger.addEventListener("mouseleave", () =>
          setTimeout(() => {
            if (!panel.matches(":hover") && !trigger.matches(":hover")) close();
          }, 80)
        );
        panel.addEventListener("mouseleave", () =>
          setTimeout(() => {
            if (!panel.matches(":hover") && !trigger.matches(":hover")) close();
          }, 80)
        );
        trigger.addEventListener("click", (e) => {
          e.preventDefault();
          panel.classList.contains("show") ? close() : open();
        });

        window.addEventListener("resize", () => {
          if (panel.classList.contains("show")) placePanel();
        });
        window.addEventListener("scroll", () => {
          if (panel.classList.contains("show")) placePanel();
        });
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") close();
        });
        overlay.addEventListener("click", close);
      }
    </script>

    <script>
      $(function () {
        $("#hero-placeholder").load("hero.html", function () {
          initHeroContactPortal();
        });

        $("#nav-placeholder").load("nav.html", function () {
          initNavPortal(); // your existing nav init
        });

        $("#about").load("about.html");
        $("#projects").load("projects.html");
        $("#technologies").load("technologies.html");
        $("#portfolio").load("portfolio.html");
      });
    </script>
  </body>
</html>
